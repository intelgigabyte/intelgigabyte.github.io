var e,E,t,n,i,o,_,a,s,c,r,T,R,S,A,I,N,D;!function(e){e.OPENID="OPENID",e.OPENID_SSO="OPENID_SSO",e.OAUTH="OAUTH",e.HTTP="HTTP",e.HTTP_LDAP="HTTP_LDAP",e.CLIENT_SSL_CERT_LDAP="CLIENT_SSL_CERT_LDAP",e.LDAP="LDAP",e.LDAP_BIND="LDAP_BIND",e.CUSTOM_EXTENSION="CUSTOM_EXTENSION",e.DEVELOPMENT_BECOME_ANY_ACCOUNT="DEVELOPMENT_BECOME_ANY_ACCOUNT"}(e||(e={})),function(e){e.ABANDONED="ABANDONED",e.MERGED="MERGED",e.NEW="NEW"}(E||(E={})),function(e){e.STRING="STRING",e.INT="INT",e.LONG="LONG",e.BOOLEAN="BOOLEAN",e.LIST="LIST",e.ARRAY="ARRAY"}(t||(t={})),function(e){e.USERNAME="USERNAME",e.FIRST_NAME="FIRST_NAME",e.FULL_NAME="FULL_NAME"}(n||(n={})),function(e){e.FULL_NAME="FULL_NAME",e.USER_NAME="USER_NAME",e.REGISTER_NEW_EMAIL="REGISTER_NEW_EMAIL"}(i||(i={})),function(e){e.ADDED="A",e.DELETED="D",e.RENAMED="R",e.COPIED="C",e.REWRITTEN="W",e.MODIFIED="M",e.UNMODIFIED="U",e.REVERTED="X"}(o||(o={})),function(e){e.BAD="BAD",e.OK="OK",e.TRUSTED="TRUSTED"}(_||(_={})),function(e){e.HEAD="HEAD",e.POST="POST",e.GET="GET",e.DELETE="DELETE",e.PUT="PUT"}(a||(a={})),function(e){e.TRUE="TRUE",e.FALSE="FALSE",e.INHERIT="INHERIT"}(s||(s={})),function(e){e.API_REF_UPDATED_AND_CHANGE_REINDEX="API_REF_UPDATED_AND_CHANGE_REINDEX",e.REF_UPDATED_AND_CHANGE_REINDEX="REF_UPDATED_AND_CHANGE_REINDEX",e.NEVER="NEVER"}(c||(c={})),function(e){e.FIXED="FIXED",e.FIX_FAILED="FIX_FAILED"}(r||(r={})),function(e){e.ACTIVE="ACTIVE",e.READ_ONLY="READ_ONLY",e.HIDDEN="HIDDEN"}(T||(T={})),function(e){e.OK="OK",e.NOT_READY="NOT_READY",e.RULE_ERROR="RULE_ERROR"}(R||(R={})),function(e){e.REVIEWER="REVIEWER",e.CC="CC",e.REMOVED="REMOVED"}(S||(S={})),function(e){e.REWORK="REWORK",e.TRIVIAL_REBASE="TRIVIAL_REBASE",e.TRIVIAL_REBASE_WITH_MESSAGE_UPDATE="TRIVIAL_REBASE_WITH_MESSAGE_UPDATE",e.MERGE_FIRST_PARENT_UPDATE="MERGE_FIRST_PARENT_UPDATE",e.NO_CODE_CHANGE="NO_CODE_CHANGE",e.NO_CHANGE="NO_CHANGE"}(A||(A={})),function(e){e.MERGE_IF_NECESSARY="MERGE_IF_NECESSARY",e.FAST_FORWARD_ONLY="FAST_FORWARD_ONLY",e.REBASE_IF_NECESSARY="REBASE_IF_NECESSARY",e.REBASE_ALWAYS="REBASE_ALWAYS",e.MERGE_ALWAYS="MERGE_ALWAYS ",e.CHERRY_PICK="CHERRY_PICK",e.INHERIT="INHERIT"}(I||(I={})),function(e){e.DONE="DONE",e.FAILED="FAILED",e.PENDING="PENDING",e.TERMINATED="TERMINATED"}(N||(N={})),function(e){e.REVISION="REVISION",e.PARENT="PARENT"}(D||(D={}));const O="PARENT";var u,C,L,l,d,f,P,U,h,g,p,G,F,M,m,H,w,V,B,W,y,b,k,K,v,Y,$,x,X,j,q,J,Q,z,Z,ee,Ee,te,ne,ie,oe,_e;function ae(e,E){return function(e){return!!e?._account_id&&!function(e){return!!e?.tags?.includes(M.SERVICE_USER)}(e)}(e)&&!!E&&(t=E,n=e._account_id,Object.prototype.hasOwnProperty.call(t,n));var t,n}function se(e,E,t){if(!ae(E,t))return"";if(void 0===t)return"";if(void 0===E?._account_id)return"";const i=t[E._account_id];return void 0===i?.reason?"":function(e,E,t){return e.replace(new RegExp("<GERRIT_ACCOUNT_(\\d+)>","g"),((e,i)=>{const o=Number(i),_=(E||[]).find((e=>e._account_id===o));return _?function(e,E,t=!1){if(E?.display_name)return E.display_name;if(!E||!E.name)return function(e,E){return E?.name?E.name:E?.username?E.username:E?.email?E.email:e&&e.user&&"Anonymous Coward"!==e.user.anonymous_coward_name?e.user.anonymous_coward_name:"Anonymous"}(e,E);const i=e?.accounts?.default_display_name;return t||i===n.FIRST_NAME?E.name.trim().split(" ")[0]:i===n.USERNAME&&E.username?E.username:E.name}(t,_):`Gerrit Account ${o}`}))}(i.reason,i?.reason_account?[i.reason_account]:[],e)}function ce(){return"undefined"==typeof window?"":self.CANONICAL_PATH||""}function re(e){let E=e.replaceAll("%","%25");return E=E.replaceAll("+","%2B"),E=encodeURIComponent(E),E=E.replace(/%3A/g,":"),E=E.replace(/%40/g,"@"),E=E.replace(/%2F/g,"/"),E=E.replace(/%20/g,"+"),E}function Te(e){return Symbol(e)}!function(e){e.PASS="PASS",e.FAIL="FAIL",e.ERROR="ERROR",e.NOT_EVALUATED="NOT_EVALUATED"}(u||(u={})),function(e){e.SATISFIED="SATISFIED",e.UNSATISFIED="UNSATISFIED",e.OVERRIDDEN="OVERRIDDEN",e.NOT_APPLICABLE="NOT_APPLICABLE",e.ERROR="ERROR",e.FORCED="FORCED"}(C||(C={})),function(e){e.OK="OK",e.NOT_READY="NOT_READY",e.CLOSED="CLOSED",e.FORCED="FORCED",e.RULE_ERROR="RULE_ERROR"}(L||(L={})),function(e){e.OK="OK",e.REJECT="REJECT",e.MAY="MAY",e.NEED="NEED",e.IMPOSSIBLE="IMPOSSIBLE",e.OPTIONAL="OPTIONAL"}(l||(l={})),function(e){e.MaxWithBlock="MaxWithBlock",e.AnyWithBlock="AnyWithBlock",e.MaxNoBlock="MaxNoBlock",e.NoBlock="NoBlock",e.Noop="Noop",e.PatchSetLock="PatchSetLock"}(d||(d={})),function(e){e.ADD_USER="ADD_USER",e.REMOVE_USER="REMOVE_USER",e.ADD_GROUP="ADD_GROUP",e.REMOVE_GROUP="REMOVE_GROUP"}(f||(f={})),function(e){e.ABANDONED="Abandoned",e.ACTIVE="Active",e.MERGE_CONFLICT="Merge Conflict",e.GIT_CONFLICT="Git Conflict",e.MERGED="Merged",e.PRIVATE="Private",e.READY_TO_SUBMIT="Ready to submit",e.REVERT="Revert",e.REVERT_CREATED="Revert Created",e.REVERT_SUBMITTED="Revert Submitted",e.WIP="WIP"}(P||(P={})),function(e){e.OK="OK",e.SAVING="SAVING",e.ERROR="ERROR"}(U||(U={})),function(e){e.SIDE_BY_SIDE="SIDE_BY_SIDE",e.UNIFIED="UNIFIED_DIFF"}(h||(h={})),function(e){e.LEFT="left",e.RIGHT="right"}(g||(g={})),function(e){e.COVERED="COVERED",e.NOT_COVERED="NOT_COVERED",e.PARTIALLY_COVERED="PARTIALLY_COVERED",e.NOT_INSTRUMENTED="NOT_INSTRUMENTED"}(p||(p={})),function(e){e.ABOVE="above",e.BELOW="below",e.BLOCK_ABOVE="block-above",e.BLOCK_BELOW="block-below",e.ALL="all"}(G||(G={})),function(e){e.ADD="add",e.BOTH="both",e.BLANK="blank",e.REMOVE="remove"}(F||(F={})),function(e){e.SERVICE_USER="SERVICE_USER"}(M||(M={})),function(e){e.FILES="files",e.COMMENT_THREADS="comments",e.CHECKS="checks",e.FLOWS="flows"}(m||(m={})),function(e){e.TAG_DELETE_REVIEWER="autogenerated:gerrit:deleteReviewer",e.TAG_NEW_PATCHSET="autogenerated:gerrit:newPatchSet",e.TAG_NEW_PATCHSET_OUTDATED_VOTES="autogenerated:gerrit:newPatchSetOutdatedVotes",e.TAG_NEW_WIP_PATCHSET="autogenerated:gerrit:newWipPatchSet",e.TAG_REVIEWER_UPDATE="autogenerated:gerrit:reviewerUpdate",e.TAG_SET_PRIVATE="autogenerated:gerrit:setPrivate",e.TAG_UNSET_PRIVATE="autogenerated:gerrit:unsetPrivate",e.TAG_SET_READY="autogenerated:gerrit:setReadyForReview",e.TAG_SET_WIP="autogenerated:gerrit:setWorkInProgress",e.TAG_MERGED="autogenerated:gerrit:merged",e.TAG_REVERT="autogenerated:gerrit:revert"}(H||(H={})),function(e){e.RUNNING="RUNNING",e.FAILED="FAILED",e.NOT_STARTED="NOT STARTED",e.SUCCESSFUL="SUCCESSFUL"}(w||(w={})),function(e){e.SUBJECT="Subject",e.OWNER="Owner",e.REVIEWERS="Reviewers",e.REPO="Repo",e.BRANCH="Branch",e.UPDATED="Updated",e.SIZE="Size",e.STATUS="Status"}(V||(V={})),function(e){e.KEEP_VISIBLE="keep-visible",e.NEVER="never"}(B||(B={})),function(e){e.PATCHSET_LEVEL_COMMENTS="/PATCHSET_LEVEL",e.COMMIT_MESSAGE="/COMMIT_MSG",e.MERGE_LIST="/MERGE_LIST"}(W||(W={})),function(e){e.RECURSIVE="recursive",e.RESOLVE="resolve",e.SIMPLE_TWO_WAY_IN_CORE="simple-two-way-in-core",e.OURS="ours",e.THEIRS="theirs"}(y||(y={})),function(e){e.ALLOW="ALLOW",e.DENY="DENY",e.BLOCK="BLOCK",e.INTERACTIVE="INTERACTIVE",e.BATCH="BATCH"}(b||(b={})),function(e){e.BATCH="BATCH",e.INTERACTIVE="INTERACTIVE"}(k||(k={})),function(e){e.AUTO="AUTO",e.DARK="DARK",e.LIGHT="LIGHT"}(K||(K={})),function(e){e.STD="STD",e.US="US",e.ISO="ISO",e.EURO="EURO",e.UK="UK"}(v||(v={})),function(e){e.HHMM_12="HHMM_12",e.HHMM_24="HHMM_24"}(Y||(Y={})),function(e){e.ENABLED="ENABLED",e.CC_ON_OWN_COMMENTS="CC_ON_OWN_COMMENTS",e.ATTENTION_SET_ONLY="ATTENTION_SET_ONLY",e.DISABLED="DISABLED"}($||($={})),function(e){e.PLAINTEXT="PLAINTEXT",e.HTML_PLAINTEXT="HTML_PLAINTEXT"}(x||(x={})),function(e){e.AUTO_MERGE="AUTO_MERGE",e.FIRST_PARENT="FIRST_PARENT"}(X||(X={})),function(e){e.PUBLISH="PUBLISH",e.PUBLISH_ALL_REVISIONS="PUBLISH_ALL_REVISIONS",e.KEEP="KEEP"}(j||(j={})),function(e){e.NONE="NONE",e.OWNER="OWNER",e.OWNER_REVIEWERS="OWNER_REVIEWERS",e.ALL="ALL"}(q||(q={})),function(e){e.ALL="ALL",e.SAME_GROUP="SAME_GROUP",e.VISIBLE_GROUP="VISIBLE_GROUP",e.NONE="NONE"}(J||(J={})),function(e){e.CODE_REVIEW="Code-Review",e.CODE_OWNERS="Code Owners",e.PRESUBMIT_VERIFIED="Presubmit-Verified"}(Q||(Q={})),function(e){e.APPROVED="APPROVED",e.REJECTED="REJECTED",e.RECOMMENDED="RECOMMENDED",e.DISLIKED="DISLIKED",e.NEUTRAL="NEUTRAL"}(z||(z={})),Q.CODE_REVIEW,Q.CODE_OWNERS,Q.PRESUBMIT_VERIFIED,Error,function(e){e.NEW_IMAGE_DIFF_UI="UiFeature__new_image_diff_ui",e.CHECKS_DEVELOPER="UiFeature__checks_developer",e.PUSH_NOTIFICATIONS_DEVELOPER="UiFeature__push_notifications_developer",e.ML_SUGGESTED_EDIT_V2="UiFeature__ml_suggested_edit_v2",e.PARALLEL_DASHBOARD_REQUESTS="UiFeature__parallel_dashboard_requests",e.ML_SUGGESTED_EDIT_UNCHECK_BY_DEFAULT="UiFeature__ml_suggested_edit_uncheck_by_default",e.ML_SUGGESTED_EDIT_FEEDBACK="UiFeature__ml_suggested_edit_feedback",e.ML_SUGGESTED_EDIT_EDITABLE_SUGGESTION="UiFeature__ml_suggested_edit_editable_suggestion",e.SHOW_FLOWS_TAB="UiFeature__show_flows_tab",e.ASYNC_SUBMIT_REQUIREMENTS="UiFeature__async_submit_requirements"}(Z||(Z={})),ee||(ee={}),new Map,function(e){e.CALLBACK_EXECUTED="CALLBACK_EXECUTED",e.TASK_CANCELLED="TASK_CANCELLED"}(Ee||(Ee={})),Symbol("Delayed Cancellation"),Symbol.species,Symbol.toStringTag,function(e){e.PLUGIN_LIFE_CYCLE="Plugin life cycle",e.STARTED_AS_USER="Started as user",e.STARTED_AS_GUEST="Started as guest",e.VISIBILILITY_HIDDEN="Visibility changed to hidden",e.VISIBILILITY_VISIBLE="Visibility changed to visible",e.FOCUS="Focus changed",e.EXTENSION_DETECTED="Extension detected",e.PLUGINS_INSTALLED="Plugins installed",e.PLUGINS_FAILED="Some plugins failed to load",e.USER_REFERRED_FROM="User referred from",e.NOTIFICATION_PERMISSION="Notification Permission",e.SERVICE_WORKER_UPDATE="Service worker update"}(te||(te={})),function(e){e.PLUGIN_API="plugin-api",e.REACHABLE_CODE="reachable code",e.METHOD_USED="method used",e.CHECKS_API_NOT_LOGGED_IN="checks-api not-logged-in",e.CHECKS_API_ERROR="checks-api error",e.USER_PREFERENCES_COLUMNS="user-preferences-columns",e.PREFER_MERGE_FIRST_PARENT="prefer-merge-first-parent",e.PUBLISHED_DRAFTS_DEDUPLICATED="published-drafts-deduplicated"}(ne||(ne={})),function(e){e.APP_STARTED="App Started",e.CHANGE_DISPLAYED="ChangeDisplayed",e.CHANGE_LOAD_FULL="ChangeFullyLoaded",e.DASHBOARD_DISPLAYED="DashboardDisplayed",e.DIFF_VIEW_CONTENT_DISPLAYED="DiffViewOnlyContent",e.DIFF_VIEW_DISPLAYED="DiffViewDisplayed",e.FILE_LIST_DISPLAYED="FileListDisplayed",e.PLUGINS_LOADED="PluginsLoaded",e.METRICS_PLUGIN_LOADED="MetricsPluginLoaded",e.STARTUP_CHANGE_DISPLAYED="StartupChangeDisplayed",e.STARTUP_CHANGE_LOAD_FULL="StartupChangeFullyLoaded",e.STARTUP_DASHBOARD_DISPLAYED="StartupDashboardDisplayed",e.STARTUP_DIFF_VIEW_CONTENT_DISPLAYED="StartupDiffViewOnlyContent",e.STARTUP_DIFF_VIEW_DISPLAYED="StartupDiffViewDisplayed",e.STARTUP_FILE_LIST_DISPLAYED="StartupFileListDisplayed",e.WEB_COMPONENTS_READY="WebComponentsReady",e.CHANGE_DATA="ChangeDataLoaded",e.CHANGE_RELOAD="ChangeReloaded",e.SEND_REPLY="SendReply",e.DIFF_TOTAL="Diff Total Render",e.DIFF_CONTENT="Diff Content Render",e.DIFF_SYNTAX="Diff Syntax Render",e.DIFF_LOAD="Diff Load Render",e.FILE_RENDER="FileListRenderTime",e.FILE_EXPAND_ALL="ExpandAllDiffs",e.DRAFT_CREATE="CreateDraftComment",e.DRAFT_UPDATE="UpdateDraftComment",e.DRAFT_DISCARD="DiscardDraftComment",e.CHECKS_LOAD="ChecksLoad",e.CLS="CLS",e.LCP="LCP",e.INP="INP",e.PREVIEW_FIX_LOAD="PreviewFixLoad",e.APPLY_FIX_LOAD="ApplyFixLoad",e.COPY_TO_CLIPBOARD="CopyToClipboard",e.COMMENT_COMPLETION="CommentCompletion"}(ie||(ie={})),function(e){e.TOGGLE_SHOW_ALL_BUTTON="toggle show all button",e.SHOW_TAB="show-tab",e.ATTENTION_SET_CHIP="attention-set-chip",e.BULK_ACTION="bulk-action",e.SAVE_COMMENT="save-comment",e.COMMENT_SAVED="comment-saved",e.DISCARD_COMMENT="discard-comment",e.COMMENT_DISCARDED="comment-discarded",e.CHECKS_TAB_RENDERED="checks-tab-rendered",e.CHECKS_CHIP_CLICKED="checks-chip-clicked",e.CHECKS_CHIP_LINK_CLICKED="checks-chip-link-clicked",e.CHECKS_RESULT_ROW_TOGGLE="checks-result-row-toggle",e.CHECKS_RESULT_DIFF_RENDERED="checks-result-diff-rendered",e.CHECKS_ACTION_TRIGGERED="checks-action-triggered",e.CHECKS_TAG_CLICKED="checks-tag-clicked",e.CHECKS_RESULT_FILTER_CHANGED="checks-result-filter-changed",e.CHECKS_RESULT_SECTION_TOGGLE="checks-result-section-toggle",e.CHECKS_RESULT_SECTION_SHOW_ALL="checks-result-section-show-all",e.CHECKS_RUN_SELECTED="checks-run-selected",e.CHECKS_RUN_LINK_CLICKED="checks-run-link-clicked",e.CHECKS_RUN_FILTER_CHANGED="checks-run-filter-changed",e.CHECKS_RUN_SECTION_TOGGLE="checks-run-section-toggle",e.CHECKS_ATTEMPT_SELECTED="checks-attempt-selected",e.CHECKS_RUNS_PANEL_TOGGLE="checks-runs-panel-toggle",e.CHECKS_RUNS_SELECTED_TRIGGERED="checks-runs-selected-triggered",e.CHECKS_STATS="checks-stats",e.COMMENTS_STATS="comments-stats",e.THREADS_STATS="threads-stats",e.CHANGE_ACTION_FIRED="change-action-fired",e.BUTTON_CLICK="button-click",e.LINK_CLICK="link-click",e.USER_ACTIVE="user-active",e.USER_PASSIVE="user-passive",e.GENERATE_SUGGESTION_REQUEST="generate_suggestion_request",e.GENERATE_SUGGESTION_RESPONSE="generate_suggestion_response",e.GENERATE_SUGGESTION_ENABLED="generate_suggestion_enabled",e.GENERATE_SUGGESTION_DISABLED="generate_suggestion_disabled",e.GENERATE_SUGGESTION_EDITED="generate_suggestion_edited",e.GENERATE_SUGGESTION_COLLAPSED="generate_suggestion_collapsed",e.GENERATE_SUGGESTION_EXPANDED="generate_suggestion_expanded",e.GENERATE_SUGGESTION_THUMB_UP="generate_suggestion_thumb_up",e.GENERATE_SUGGESTION_THUMB_DOWN="generate_suggestion_thumb_down",e.START_REVIEW="start-review",e.CODE_REVIEW_APPROVAL="code-review-approval",e.FILE_LIST_DIFF_COLLAPSED="file-list-diff-collapsed",e.FILE_LIST_DIFF_EXPANDED="file-list-diff-expanded",e.FILE_LIST_ALL_DIFFS_COLLAPSED="file-list-all-diffs-collapsed",e.FILE_LIST_ALL_DIFFS_EXPANDED="file-list-all-diffs-expanded",e.CHANGE_ID_CHANGED="change-id-changed",e.COMMENT_COMPLETION_SUGGESTION_SHOWN="comment-completion-suggestion-shown",e.COMMENT_COMPLETION_SUGGESTION_ACCEPTED="comment-completion-suggestion-accepted",e.COMMENT_COMPLETION_SAVE_DRAFT="comment-completion-save-draft",e.COMMENT_COMPLETION_SUGGESTION_FETCHED="comment-completion-suggestion-fetched"}(oe||(oe={})),Symbol("providers"),Symbol("resolvers"),Event,Error,function(e){e.TRIGGER_NOTIFICATIONS="TRIGGER_NOTIFICATIONS",e.USER_PREFERENCE_CHANGE="USER_PREFERENCE_CHANGE",e.REPORTING="REPORTING"}(_e||(_e={}));Te("service-worker-installer");const Re="states";function Se(){return new Promise(((e,E)=>{const t=indexedDB.open("service-worker-db-1");t.onsuccess=()=>e(t.result),t.onerror=E,t.onblocked=E,t.onupgradeneeded=()=>{const e=t.result;e.objectStoreNames.contains(Re)||e.createObjectStore(Re,{keyPath:"id"}).createIndex("states_id_unique","id",{unique:!0})}}))}var Ae,Ie;!function(e){e.ADMIN="admin",e.AGREEMENTS="agreements",e.CHANGE="change",e.DASHBOARD="dashboard",e.DOCUMENTATION_SEARCH="documentation-search",e.GROUP="group",e.PLUGIN_SCREEN="plugin-screen",e.REPO="repo",e.SEARCH="search",e.SERVER_INFO="server-info",e.SETTINGS="settings"}(Ae||(Ae={})),Te("router-model"),function(e){e[e.USER=0]="USER",e[e.REPO=1]="REPO",e[e.CUSTOM=2]="CUSTOM"}(Ie||(Ie={}));const Ne=/\${(project|repo)}/g;var De;function Oe(e){const E=function(e){return e.change?{...e,view:Ae.CHANGE,changeNum:e.change._number,repo:e.change.project}:{...e,view:Ae.CHANGE}}({...e,childView:De.OVERVIEW});let t="";const n=[];return E.checksPatchset&&E.checksPatchset>0&&E.patchNum!==E.checksPatchset&&n.push(`checksPatchset=${E.checksPatchset}`),E.attempt&&"latest"!==E.attempt&&n.push(`attempt=${E.attempt}`),E.filter&&n.push(`filter=${E.filter}`),E.checksResultsFilter&&n.push(`checksResultsFilter=${E.checksResultsFilter}`),E.checksRunsSelected&&E.checksRunsSelected.size>0&&n.push(`checksRunsSelected=${[...E.checksRunsSelected].sort()}`),E.tab&&E.tab!==m.FILES&&n.push(`tab=${E.tab}`),E.forceReload&&n.push("forceReload=true"),E.openReplyDialog&&n.push("openReplyDialog=true"),E.usp&&n.push(`usp=${E.usp}`),E.edit&&(t+=",edit"),E.commentId&&(t+=`/comments/${E.commentId}`),n.length>0&&(t+="?"+n.join("&")),E.messageHash&&(t+=E.messageHash),`${function(e){let E=function(e){let E="";return e.patchNum&&(E=`${e.patchNum}`),e.basePatchNum&&e.basePatchNum!==O&&(E=`${e.basePatchNum}..${E}`),E}(e);E.length&&(E="/"+E);let t="";return e.repo&&(t=`${re(e.repo)}/+/`),`${ce()}/c/${t}${e.changeNum}${E}`}(E)}${t}`}Te("dashboard-view-model"),function(e){e.OVERVIEW="OVERVIEW",e.DIFF="DIFF",e.EDIT="EDIT"}(De||(De={})),Te("change-view-model");const ue=self,Ce=new class{constructor(e){this.ctx=e,this.latestUpdateTimestampMs=Date.now(),this.allowBrowserNotificationsPreference=!1}async init(){await this.loadState(),this.ctx.addEventListener("message",(e=>this.onMessage(e))),this.ctx.addEventListener("notificationclick",(e=>this.onNotificationClick(e)))}saveState(){return async function(e){const E=(await Se()).transaction(Re,"readwrite");return E.objectStore(Re).put({...e,id:1}),new Promise((e=>{E.oncomplete=()=>e()}))}({latestUpdateTimestampMs:this.latestUpdateTimestampMs,allowBrowserNotificationsPreference:this.allowBrowserNotificationsPreference})}async loadState(){const e=await async function(){const e=(await Se()).transaction(Re,"readonly").objectStore(Re);return new Promise(((E,t)=>{const n=e.get(1);n.onsuccess=()=>E(n.result),n.onerror=t}))}();e&&(this.latestUpdateTimestampMs=e.latestUpdateTimestampMs,this.allowBrowserNotificationsPreference=e.allowBrowserNotificationsPreference)}onMessage(e){e.data?.type===_e.TRIGGER_NOTIFICATIONS?e.waitUntil(this.showLatestAttentionChangeNotification(e.data?.account)):e.data?.type===_e.USER_PREFERENCE_CHANGE&&e.waitUntil(this.allowBrowserNotificationsPreferenceChanged(e.data?.allowBrowserNotificationsPreference))}onNotificationClick(e){e.notification.close(),e.waitUntil(this.openWindow(e.notification.data.url))}async allowBrowserNotificationsPreferenceChanged(e){this.allowBrowserNotificationsPreference=e,await this.saveState()}async showLatestAttentionChangeNotification(e){if(!e?._account_id)return;if(!this.allowBrowserNotificationsPreference)return;const E=await this.getChangesToNotify(e),t=E.length;1===t?this.showNotificationForChange(E[0],e):t>1&&this.showNotificationForDashboard(t)}async openWindow(e){if(!e)return;const E=await this.ctx.clients.matchAll({type:"window"});try{let t=E.find((E=>E.url===e));t||(t=await this.ctx.clients.openWindow(e)??void 0),await(t?.focus())}catch(e){console.error(`Cannot open window about notified change - ${e}`)}}showNotificationForChange(e,E){const t=se(void 0,E,e.attention_set),n=Oe({change:e,usp:"service-worker-notification"}),i={url:`${self.location.origin}${n}`},o=`${self.location.origin}/favicon.ico`;this.ctx.registration.showNotification(e.subject,{body:t,data:i,icon:o}),this.sendReport("notify about 1 change")}showNotificationForDashboard(e){const E=`You are in the attention set for ${e} new changes.`,t=function(e){const E=e.project||void 0;if(e.sections){const t=function(e,E){return e.map((e=>{const t=E?e.query.replace(Ne,E):e.query;return re(e.name)+"="+re(t)}))}(e.sections,E);e.title&&t.push("title="+re(e.title));const n=e.user?e.user:"";return`${ce()}/dashboard/${n}?${t.join("&")}`}if(E){const t=re(E);return`${ce()}/p/${t}/+/dashboard/${e.dashboard}`}return`${ce()}/dashboard/${e.user||"self"}`}({type:Ie.USER}),n={url:`${self.location.origin}${t}`},i=`${self.location.origin}/favicon.ico`;this.ctx.registration.showNotification(E,{data:n,icon:i}),this.sendReport(`notify about ${e} changes`)}async getChangesToNotify(e){if(Date.now()-this.latestUpdateTimestampMs<3e5)return[];const E=this.latestUpdateTimestampMs;this.latestUpdateTimestampMs=Date.now(),await this.saveState(),this.sendReport("polling");const t=function(e,E,t){return e.filter((e=>{const n=e.attention_set[E._account_id];if(!n.last_update)return!1;const i=(o=n.last_update,new Date(o.replace(" ","T")+"Z")).valueOf();var o;return t<i}))}(await this.getLatestAttentionSetChanges(),e,E);return t}async getLatestAttentionSetChanges(){const e=await fetch("/changes/?O=1000081&S=0&n=25&q=attention%3Aself");try{return(await async function(e){const E=await e.text();let t;try{n=E,t=JSON.parse(n.substring(4))}catch(e){throw new Error(`Response payload is not prefixed json. Payload: ${E}`)}var n;return{parsed:t,raw:E}}(e)).parsed}catch(e){return e instanceof Error&&console.warn(`Request for latest attention set changes failed. Error: ${e.message}`),[]}}async sendReport(e){const E=await this.ctx.clients.matchAll({type:"window"}),t=E?.[0];t&&t.postMessage({type:_e.REPORTING,eventName:e})}}(ue);Ce.init();